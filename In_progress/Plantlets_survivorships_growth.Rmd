--- 
title: 'Plantlets survivorships and growth'
author: "Peggy Martinez, Rachael Barron, Marcelo Serpe, Sven Buerki"
output:
  bookdown::html_document2: 
    toc: TRUE
    toc_float: TRUE
link-citations: yes
fontsize: 12pt
bibliography: packages.bib
---

```{r packages, echo=FALSE, warning=FALSE, include=FALSE}
library(knitr)
library(rmarkdown)
library(bookdown)
#library(distill)
library(knitcitations)
library(formatR)
library(devtools)
library(gplots)
library(RColorBrewer)
library(grDevices)

#Generate BibTex citation file for all R packages used to produce report
knitr::write_bib(.packages(), file = 'packages.bib')
```


```{r setup, include=FALSE, cache=FALSE, message = FALSE}
#Load packages
library(knitr)
library(rmarkdown)
# Chunk options: see http://yihui.name/knitr/options/ ###

## Text results
opts_chunk$set(echo = TRUE, warning = TRUE, message = TRUE, include = TRUE)

## Code decoration
#opts_chunk$set(tidy = TRUE, R.options = list(width = 60), highlight = TRUE)

## Caching code
opts_chunk$set(cache = 2, cache.path = "cache/")

## Plots
#opts_chunk$set(fig.path = "Figures_MS/", dev=c('pdf', 'png'), dpi = 300)

## Locate figures as close as possible to requested position (=code)
#opts_chunk$set(fig.pos = "H")
```

# Survivorship curves

```{r}
###~~~
#Load data on phenotypes, survival and height (with knowledge on rooting clusters)
###~~~
plant <- read.csv("01_Raw_Data/Survival_height_clones.csv")

cluster <- as.vector(unique(plant$Cluster))


for(i in 1:length(cluster)){
  #Subset by cluster
  clustInd <- subset(plant, plant$Cluster == cluster[i])
  
  #Subset matrix to only include relevant cols
  clustIndMat <- clustInd[, c(4, grep("_w_survival", colnames(clustInd)))]
  
  #Replace 0.5 by 1
  clustIndMat[clustIndMat == "0.5"] <- "1"
 
  #Create a list of ind. in clustIndMat
  ind <- unique(as.vector(clustIndMat$SeedID))
  
  matInd <- matrix(nrow = length(ind), ncol=ncol(clustIndMat)-1)
  rownames(matInd) <- ind
  for(j in 1:nrow(matInd)){
    indPlant <- subset(clustIndMat[,-1], clustIndMat$SeedID == ind[j])
    matInd[j,] <- apply(data.matrix(indPlant), MARGIN = 2, sum)
  }
  colnames(matInd) <- seq(from=1, to=ncol(matInd))
  
  plot(x=1, y=1, type='n', ylim = c(0,max(matInd)), xlim=c(1,3), xaxt = 'n')
  axis(side=1, at=c(1,2,3), labels = c("3","5","7"), las=2, cex.axis=0.7)
  
  for(k in 1:nrow(matInd)){
    tmp <- matInd[k,]
    for(l in 1:length(tmp)){
      #Horizontal lines
      segments(x0 = as.numeric(names(tmp[l])), x1 = as.numeric(names(tmp[l+1])), y0 = as.numeric(tmp[l]), y1 = as.numeric(tmp[l]))
      #Vertical
      segments(x0 = as.numeric(names(tmp[l+1])), x1 = as.numeric(names(tmp[l+1])), y0 = as.numeric(tmp[l]), y1 = as.numeric(tmp[l+1]))
    }
    
  }
}
```

# Phenotypes

After 7 weeks of culture, 4 phenotypes have been recognized:

-  P1: Unpersistent leaves, branching (lot of shoot tips), whitish, fine roots.
- P2: Unpersistent leaves, unbranched (tall), whitish, fine roots.
- P3: Persistant leaves, slow grower, only 1 long tap root (thick).
- P4: Large wide unpersistent leaves, red think and lots of roots (phenolic).
- P2/P4: Unpersistent leaves, unbranched with beginning of red roots.

**Remark:** P1 and P2 are close, but mostly differ by their bushyness: unbranched in P1 vs. branched in P2. This could lead to producing more shoot tips in P2 comparedto P1 at same heights. If proven correct, then P2 would be favored for genome sequencing.

## Do plantlets from the same individual exhibit consistent phenotypes?

```{r}
###~~~
#Load data on phenotypes, survival and height (with knowledge on rooting clusters)
###~~~
plant <- read.csv("01_Raw_Data/Survival_height_clones.csv")

# Only include plantlets alived at week 7
plantHealthy <- subset(plant, plant$X7_w_survival != 0)

```

